{
  "hash": "119dacaf36d6dc0b8846d09a4ec29301",
  "result": {
    "markdown": "---\ntitle: \"OBS with ggplot2\"\nauthor: \"Jinwon Lee\"\ndate: \"2023-03-27\"\ncategories: [Visualization, Code, R]\npage-layout: full\nimage: \"KMA.png\"\noutput:\n  prettydoc::html_pretty:\n    theme: architect\n    highlight: github\neditor_options:\n  chunk_output_type: console\nmainfont: NanumGothic\n---\n\n\n\n\n## 기상청 ASOS 데이터를 활용한 `ggplot2` 실습\n- 데이터 출처 : https://data.kma.go.kr/data/grnd/selectAsosRltmList.do?pgmNo=36\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Read csv File\ndata_2021 <- read.csv(\"../data/OBS_ASOS_DD_20220308125952.csv\", fileEncoding = \"CP949\")\ndata_2021 %>% dim()\n#> [1] 1460    6\n\ndata_2021 %>% head()\n#>   지점 지점명       일시 평균기온..C. 최저기온..C. 최고기온..C.\n#> 1  108   서울 2021-01-01         -4.2         -9.8          1.6\n#> 2  108   서울 2021-01-02         -5.0         -8.4         -1.4\n#> 3  108   서울 2021-01-03         -5.6         -9.1         -2.0\n#> 4  108   서울 2021-01-04         -3.5         -8.4          0.3\n#> 5  108   서울 2021-01-05         -5.5         -9.9         -2.1\n#> 6  108   서울 2021-01-06         -7.4        -12.0         -1.9\n\n# 자료형 확인\ndata_2021 %>% sapply(class)\n#>         지점       지점명         일시 평균기온..C. 최저기온..C. 최고기온..C. \n#>    \"integer\"  \"character\"  \"character\"    \"numeric\"    \"numeric\"    \"numeric\"\n\n# Date Type Convert : Character -> Date\ndata_2021$일시 <- data_2021$일시 %>% as.Date(\"%Y-%m-%d\")\ndata_2021 %>% sapply(class)\n#>         지점       지점명         일시 평균기온..C. 최저기온..C. 최고기온..C. \n#>    \"integer\"  \"character\"       \"Date\"    \"numeric\"    \"numeric\"    \"numeric\"\n\n# 기초통계량 확인\ndata_2021 %>% summary()\n#>       지점          지점명               일시             평균기온..C.   \n#>  Min.   :108.0   Length:1460        Min.   :2021-01-01   Min.   :-14.90  \n#>  1st Qu.:126.8   Class :character   1st Qu.:2021-04-02   1st Qu.:  7.90  \n#>  Median :158.5   Mode  :character   Median :2021-07-02   Median : 15.00  \n#>  Mean   :166.0                      Mean   :2021-07-02   Mean   : 14.77  \n#>  3rd Qu.:197.8                      3rd Qu.:2021-10-01   3rd Qu.: 23.10  \n#>  Max.   :239.0                      Max.   :2021-12-31   Max.   : 31.70  \n#>   최저기온..C.     최고기온..C.   \n#>  Min.   :-19.10   Min.   :-10.70  \n#>  1st Qu.:  3.10   1st Qu.: 13.18  \n#>  Median : 11.10   Median : 20.15  \n#>  Mean   : 10.69   Mean   : 19.56  \n#>  3rd Qu.: 19.60   3rd Qu.: 27.70  \n#>  Max.   : 28.10   Max.   : 36.50\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# X축 눈금 지정\ndate_s <- \"2021-01-01\" %>% as.Date(\"%Y-%m-%d\")\ndate_e <- \"2022-01-01\" %>% as.Date(\"%Y-%m-%d\")\nbreak_date <- seq.Date(date_s, date_e, by = \"3 month\") # 3달 간격 Date 생성\nlabel_date <- paste0(c(seq(1, 12, 3), 1), \"월\")\n\n# ggplot + 축 설정\ndata_2021 %>% names() # 열 이름 추출\n#> [1] \"지점\"         \"지점명\"       \"일시\"         \"평균기온..C.\" \"최저기온..C.\"\n#> [6] \"최고기온..C.\"\n\nggplot(data_2021, aes(x = 일시, y = 평균기온..C., color = 지점명)) +\n    geom_line(linewidth = 1) +\n    scale_x_date(name = \"월\", breaks = break_date, labels = label_date) +\n    scale_y_continuous(name = \"평균기온\") +\n    theme_light()\n```\n\n::: {.cell-output-display}\n![](OBS_2021_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# 월 평균\ndata_2021_month <- data_2021 %>%\n    mutate(month = format(일시, \"%B\")) %>% # month열 생성\n    group_by(지점명, month) %>%\n    summarize(mean = mean(평균기온..C., na.rm = TRUE)) %>%\n    ungroup() %>%\n    mutate(month = factor(month, levels = paste0(1:12, \"월\"))) # factor 형으로 변환\n#> `summarise()` has grouped output by '지점명'. You can override using the\n#> `.groups` argument.\ndata_2021_month\n#> # A tibble: 48 × 3\n#>    지점명 month   mean\n#>    <chr>  <fct>  <dbl>\n#>  1 대전   10월  15.7  \n#>  2 대전   11월   8.91 \n#>  3 대전   12월   1.89 \n#>  4 대전   1월   -0.984\n#>  5 대전   2월    3.99 \n#>  6 대전   3월    9.61 \n#>  7 대전   4월   14.7  \n#>  8 대전   5월   17.7  \n#>  9 대전   6월   23.5  \n#> 10 대전   7월   27.8  \n#> # … with 38 more rows\n\n# ggplot + geom_tile + fill_color\nggplot(data_2021_month, aes(x = month, y = 지점명, fill = mean)) +\n    geom_tile(width = .95, height = .95) +\n    scale_fill_viridis_c(\n        option = \"B\", begin = 0.15, end = 0.98, # 시작과 끝 색상 지정\n        name = \"temperature\"\n    ) +\n    coord_fixed(expand = FALSE) +\n    ylab(NULL)\n```\n\n::: {.cell-output-display}\n![](OBS_2021_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "OBS_2021_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}